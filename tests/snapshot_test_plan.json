{
  "name": "Snapshot Health Plan",
  "preflight": [
    {
      "name": "verify_minimal_defaults",
      "cmd": ["xsarena", "ops", "snapshot", "verify", "--mode", "minimal", "--max-per-file", "180000", "--total-max", "2500000", "--disallow", "books/**", "--disallow", "review/**", "--disallow", ".xsarena/**", "--fail-on", "oversize", "--fail-on", "disallowed", "--fail-on", "secrets"],
      "expect_exit": 0
    }
  ],
  "produce": [
    {
      "name": "txt_ultra_tight",
      "cmd": ["xsarena", "ops", "snapshot", "txt", "--preset", "ultra-tight", "--total-max", "2500000", "--max-per-file", "180000", "--no-repo-map"],
      "expect_exit": 0
    },
    {
      "name": "write_tight_zip",
      "cmd": ["xsarena", "ops", "snapshot", "write", "--mode", "tight", "--with-git=false", "--with-jobs=false", "--with-manifest=false", "--zip"],
      "expect_exit": 0
    }
  ],
  "postflight": [
    {
      "name": "verify_flatpack",
      "cmd": ["xsarena", "ops", "snapshot", "verify", "--file", "repo_flat.txt", "--max-per-file", "180000", "--fail-on", "oversize", "--fail-on", "disallowed", "--redaction-expected"],
      "expect_exit": 0
    }
  ]
}
